- name: Sync collaborator forks via merge-upstream API
  env:
    GH_TOKEN: ${{ secrets.ARPC_SYNC_TOKEN }}
  run: |
    set -euo pipefail

    # Try syncing just this one repo first (arpc-ndsu fork of ftsiboe/arpcFCIP)
    REPO="arpc-ndsu/arpcFCIP"
    BRANCH="$(gh api "repos/${REPO}" --jq '.default_branch')"
    PARENT="$(gh api "repos/${REPO}" --jq '.parent.full_name // empty')"

    echo "Repo: $REPO"
    echo "Parent: $PARENT"
    echo "Branch: $BRANCH"

    if [ -z "$PARENT" ]; then
      echo "This repo is not a fork (no parent)."
      exit 0
    fi

    echo "Calling merge-upstream..."
    gh api -X POST "repos/${REPO}/merge-upstream" -f branch="${BRANCH}"
